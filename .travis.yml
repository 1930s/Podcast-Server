language: java

jdk:
- oraclejdk8

sudo: required

services:
- docker

install: true

before_script:
- npm install -g jspm
- jspm config registries.github.auth $JSPM_GITHUB_AUTH_TOKEN

script: mvn test jacoco:report

after_success:
- mvn coveralls:report

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: X9W0MGueni+7ly75mS+NtEAWzJWaD1CZxOtf2OBYQ0wDVABzTO2gztSQjSwgttThrwEVWeAKS7TUE8WUHSpqGoD5pkfKwOMgyiX2angPWuvtWvBgguzuxdNAiQxMVVC+0KOVcXdeuvSMt69HjoVQVa0IKOqkRDwle6U2bQXSrOk=
  file: target/Podcast-Server.jar
  on:
    repo: davinkevin/Podcast-Server
    tags: true

after_deploy:
- mvn docker:build
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
- docker push davinkevin/podcast-server

env:
  global:
  - secure: knWjqJ3qz9AYfKgBqBTcgpzEe/XMDpG0Bpi/VsUFgdsi151Ob6z1mnfhGEuJ0CoSH6U1GGvCtBLvma0bAXhOyWYDh1ka9EjwdSQKqwLxcjhYSkKui88fPwvIl1s9KWcjr2yd2Yptoz2Up4TnXOJjj+m8b4jFBmkwW6t3GjDT6W4=
  - secure: IrOb+0Y6TYtOmKR80vQIu3SOlaLm2CHu/h4NpXJDJnSLXv3hKF/HJbvS7S/MALWG/gFFbAcD6zaZzsJgrmBHVMFKdNwDIIVlj4lxK5fjFY16uGCboQSijE4hXtCgZNwuqgsmzoe8rhehrju5yeBooPZvecj62AUXVkkHwv0f3IA=
  - secure: CS+sdLkKk+ZGy8HsBoSBbhy5exqfWRU3Q4c/W0S0UB8QBFKhguhLZg4XD/L3J39tPdpBZDHbRDmGb3cz4oKdk0xYfD6WEFgCIf2xcVhaD66W3qXaOSNglZvSJpjQKgCBAACZG2WBDsTHJuTayOfgMu8cfbVvfYstbkCcv08JCoo=
